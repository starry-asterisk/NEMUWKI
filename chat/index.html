<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/resource/favicon.ico">
    <link rel="apple-touch-icon" href="/resource/favicon.ico" />
    <title>채팅</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-design-icons@3.0.1/iconfont/material-icons.css">
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="chat-container">
        <aside class="chat-sidebar">
            <div class="sidebar-header">
                <h2>채팅</h2>
                <div class="header-icons">
                    <button class="icon-btn" id="createRoomBtn" title="새 채팅방">
                        <span class="material-icons">add</span>
                    </button>
                </div>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="검색...">
                <span class="material-icons">search</span>
            </div>

            <div class="sidebar-notice-area">
                <a href="/chat/?room=qs8NlBtDzaLpm7JdFh2p" class="notice-link">
                    <span class="notice-icon">📢</span>
                    <div class="notice-content">
                        <span class="notice-title">공지사항</span>
                        <span class="notice-text">이용 가이드 및 규칙</span>
                    </div>
                    <span class="notice-arrow">▶</span>
                </a>
            </div>

            <div class="chat-list" id="chatList">
                <div class="muted-center">
                    로드 중...
                </div>
            </div>
        </aside>

        <section class="chat-main">
            <div class="empty-state" id="emptyState">
                <div class="empty-content">
                    <span class="material-icons">chat_bubble_outline</span>
                    <p>채팅을 시작해보세요</p>
                </div>
            </div>

            <div class="chat-room hidden" id="chatRoom">
                <header class="chat-header">
                    <div class="header-left">
                        <button class="back-btn" id="backBtn">
                            <span class="material-icons">arrow_back</span>
                        </button>
                        <div class="room-info">
                            <h3 id="roomTitle">채팅방</h3>
                            <span class="room-status" id="roomStatus">온라인</span>
                        </div>
                    </div>
                    <div class="header-right">
                        <button class="icon-btn" id="settingsBtn" title="설정">
                            <span class="material-icons">settings</span>
                        </button>
                        <button class="icon-btn" id="shareBtn" title="공유">
                            <span class="material-icons">share</span>
                        </button>
                        <button class="icon-btn" id="infoBtn" title="정보">
                            <span class="material-icons">info</span>
                        </button>
                    </div>
                </header>

                <div class="messages" id="messages"></div>

                <div class="typing-indicator-container" id="typingIndicatorContainer"></div>

                <footer class="chat-input-area">
                    <div class="input-wrapper">
                        <button class="icon-btn" id="selectSpeakerBtn" title="발신자 선택">
                            <span class="material-icons">person</span>
                        </button>
                        <div class="speaker-selector" id="speakerSelector">
                            <div class="speaker-dropdown" id="speakerDropdown"></div>
                        </div>
                        <textarea id="messageInput" placeholder="메시지를 입력하세요..." data-speaker="me"></textarea>
                        <button class="send-btn" id="sendBtn">
                            <span class="material-icons">send</span>
                        </button>
                    </div>
                </footer>
            </div>
        </section>
    </div>

    <div class="modal hidden" id="createRoomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 채팅방</h3>
                <button class="close-btn" id="closeModalBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="roomTitleInput">채팅방 이름</label>
                    <input type="text" id="roomTitleInput" placeholder="채팅방 이름을 입력하세요" maxlength="50">
                </div>
                <div class="form-group">
                    <label for="roomDescription">설명</label>
                    <textarea id="roomDescription" placeholder="채팅방 설명 (선택사항)" maxlength="200" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="narratorEmails">서술자 이메일</label>
                    <input type="text" id="narratorEmails"
                        placeholder="이메일을 쉼표로 구분하여 입력 (예: user@example.com, another@example.com)">
                </div>
                <div class="form-group">
                    <label for="speakerNames">화자 이름</label>
                    <input type="text" id="speakerNames" placeholder="이름을 쉼표로 구분하여 입력 (예: 서술자1, 서술자2)">
                </div>
                <div class="form-group">
                    <label for="roomProfileImage">프로필 이미지 URL</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="roomProfileImage" placeholder="이미지 URL을 입력하세요 (선택사항)" class="flex-1">
                        <button class="btn-create btn-auto" id="selectRoomProfileImageBtn">선택</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="roomBackgroundImage">배경 이미지 URL</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="roomBackgroundImage" placeholder="배경 이미지 URL (선택사항)" class="flex-1">
                        <button class="btn-create btn-auto" id="selectRoomBackgroundImageBtn">선택</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="roomBackgroundPattern">배경 패턴</label>
                    <select id="roomBackgroundPattern">
                        <option value="">없음</option>
                        <option value="dots">점 패턴</option>
                        <option value="lines">선 패턴</option>
                        <option value="grid">격자 패턴</option>
                        <option value="diagonal">사선 패턴</option>
                        <option value="waves">파도 패턴</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelBtn">취소</button>
                <button class="btn-create" id="confirmCreateBtn">생성</button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="manageRoomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>채팅방 관리</h3>
                <button class="close-btn" id="closeManageModalBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editRoomTitle">채팅방 이름</label>
                    <input type="text" id="editRoomTitle" placeholder="채팅방 이름" maxlength="50">
                </div>
                <div class="form-group">
                    <label for="editRoomDescription">설명</label>
                    <textarea id="editRoomDescription" placeholder="채팅방 설명" maxlength="200" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>서술자</label>
                    <section id="narratorList"></section>
                </div>
                <div class="form-group">
                    <label>화자 추가</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="speakerName" placeholder="화자 이름을 입력하세요" class="flex-1">
                        <button class="btn-create" id="addSpeakerBtn">추가</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>화자</label>
                    <section id="speakerList"></section>
                </div>
                <div class="form-group">
                    <label for="editRoomProfileImage">프로필 이미지 URL</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="editRoomProfileImage" placeholder="이미지 URL" class="flex-1">
                        <button class="btn-create btn-auto" id="selectEditRoomProfileImageBtn">선택</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editRoomBackgroundImage">배경 이미지 URL</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="editRoomBackgroundImage" placeholder="배경 이미지 URL" class="flex-1">
                        <button class="btn-create btn-auto" id="selectEditRoomBackgroundImageBtn">선택</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editRoomBackgroundPattern">배경 패턴</label>
                    <select id="editRoomBackgroundPattern">
                        <option value="">없음</option>
                        <option value="dots">점 패턴</option>
                        <option value="lines">선 패턴</option>
                        <option value="grid">격자 패턴</option>
                        <option value="diagonal">사선 패턴</option>
                        <option value="waves">파도 패턴</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-danger" id="deleteRoomBtn">채팅방 삭제</button>
                <div class="flex-spacer"></div>
                <button class="btn-cancel" id="cancelManageBtn">취소</button>
                <button class="btn-create" id="saveRoomBtn">저장</button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="roomInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>채팅방 정보</h3>
                <button class="close-btn" id="closeInfoModalBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="info-item">
                    <label>채팅방 이름</label>
                    <p id="infoRoomTitle">-</p>
                </div>
                <div class="info-item">
                    <label>설명</label>
                    <p id="infoRoomDescription">-</p>
                </div>
                <div class="info-item">
                    <label>생성일</label>
                    <p id="infoCreatedDate">-</p>
                </div>
                <div class="info-item">
                    <label>서술자</label>
                    <p id="infoNarrators">-</p>
                </div>
                <div class="info-item">
                    <label>화자</label>
                    <p id="infoSpeakers">-</p>
                </div>
                <div class="info-item">
                    <label>메시지 수</label>
                    <p id="infoMessageCount">-</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="closeInfoBtn">닫기</button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="shareRoomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>채팅방 공유</h3>
                <button class="close-btn" id="closeShareModalBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>링크 공유</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="shareLink" readonly placeholder="링크 공유" class="flex-1">
                        <button class="btn-create" id="copyLinkBtn">복사</button>
                    </div>
                </div>
                <hr class="hr-sep">
                <div class="form-group">
                    <label>이메일로 추가</label>
                    <div class="form-group-horizontal">
                        <input type="text" id="shareEmail" placeholder="이메일을 입력하세요" class="flex-1">
                        <button class="btn-create" id="addNarratorBtn">추가</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>서술자</label>
                    <section id="shareNarratorList"></section>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="closeShareBtn">닫기</button>
            </div>
        </div>
    </div>

    <div class="context-menu hidden" id="roomContextMenu">
        <button class="menu-item" id="editRoomMenuItem">
            <span class="material-icons">edit</span>
            <span>관리</span>
        </button>
        <button class="menu-item" id="leaveRoomMenuItem">
            <span class="material-icons">logout</span>
            <span>나가기</span>
        </button>
    </div>

    <div class="modal hidden" id="imageSelectorModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>이미지 선택</h3>
                <button class="close-btn" id="closeImageSelectorBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>업로드 또는 링크 입력</label>
                    <div class="form-group-horizontal">
                        <button class="btn-upload" onclick="imageFileInput.click();">파일 업로드</button>
                        <button class="btn-create" id="imageLinkBtn">링크 입력</button>
                        <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                    </div>
                    <div id="imageUploadStatus" class="muted-small" style="margin-top: 8px;"></div>
                </div>

                <div class="form-group">
                    <label>저장된 이미지</label>
                    <div id="imageSelectorList" class="image-selector-list"></div>
                </div>

                <div class="form-group">
                    <label>선택된 이미지</label>
                    <div id="selectedImagePreview" class="image-preview image-preview--empty">
                        선택된 이미지 없음
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelImageSelectorBtn">취소</button>
                <button class="btn-create" id="confirmImageSelectorBtn" disabled>선택</button>
            </div>
        </div>
    </div>

    <script src="js/firebase.js?_=0.3" type="module"></script>
    <script src="js/chat-firebase.js?_=0.3"></script>
    <script src="js/utils.js?_=0.3"></script>
    <script src="js/modal.js?_=0.3"></script>
    <script src="js/imageUtils.js?_=0.3"></script>
    <script src="js/functions.js?_=0.3"></script>
    <script src="js/variables.js?_=0.3"></script>
    <script src="js/lib/peerjs.min.js"></script>
    <script src="js/chat-peer.js?_=0.3"></script>
    <script src="js/index.js?_=0.3"></script>
</body>

</html>